CREATE DATABASE IF NOT EXISTS events;
USE events;

---- SQL BELOW IS GENERATED BY DBDESIGNER.NET
CREATE TABLE IF NOT EXISTS `events` (
	`id` int AUTO_INCREMENT NOT NULL UNIQUE,
	`mail_acc_type` enum('outlook', 'gmail') NOT NULL,
	`mail_acc_id` varchar(256) NOT NULL,
	`start_date` datetime,
	`end_date` datetime,
	`country` varchar(64) NOT NULL,
	`city` varchar(64) NOT NULL,
	`address` varchar(64) NOT NULL,
	`room` varchar(64) NOT NULL,
	PRIMARY KEY (`id`)
);

CREATE TABLE IF NOT EXISTS `tags_to_events` (
	`tag_id` int NOT NULL,
	`event_id` int NOT NULL
	PRIMARY KEY (`tag_id`, `event_id`)
);

CREATE TABLE IF NOT EXISTS `tags` (
	`id` int AUTO_INCREMENT NOT NULL UNIQUE,
	`name` varchar(64) NOT NULL UNIQUE,
	PRIMARY KEY (`id`)
);

CREATE TABLE IF NOT EXISTS `parsed_emails` (
	`email_id` varchar(256) NOT NULL UNIQUE,
	`parsed_at` timestamp NOT NULL,
	PRIMARY KEY (`email_id`)
);

ALTER TABLE `tags_to_events` ADD CONSTRAINT `tags_to_events_fk0` FOREIGN KEY (`tag_id`) REFERENCES `tags`(`id`);
ALTER TABLE `tags_to_events` ADD CONSTRAINT `tags_to_events_fk1` FOREIGN KEY (`event_id`) REFERENCES `events`(`id`);
---- SQL ABOVE IS GENERATED BY DBDESIGNER.NET

CREATE USER 'events'@'localhost' IDENTIFIED BY '---CHANGE THIS---';
CREATE USER 'events'@'remote-ip-addr' IDENTIFIED BY '---CHANGE THIS---'; -- for the remote server that handles fetching emails and parsing events
GRANT SELECT, UPDATE, INSERT ON events.* TO 'events'@'localhost';
GRANT SELECT, UPDATE, INSERT ON events.* TO 'events'@'remote-ip-addr';
FLUSH PRIVILEGES;