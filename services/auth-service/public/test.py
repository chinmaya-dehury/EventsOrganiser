import jwt, jwt.exceptions
import server_config

def decode_jwt_token(id_token: str, keys: dict, audience: str) -> tuple[dict, str]:
    """Verifies that a JWT is signed by a valid (trusted) public key

       Returns the decoded token if it is valid, otherwise None and an error message
    """
    header = jwt.get_unverified_header(id_token)
    decrypt_key = None
    for key in keys["keys"]:
        if(key["kid"] == header["kid"]):
            decrypt_key = key
            break
    if(decrypt_key == None):
        return None, f"Key {header['kid']} not found in Microsoft Entra tenant-independent key endpoint"
    
    try:
        decoded = jwt.decode(
            jwt=id_token,
            key=jwt.PyJWK.from_dict(decrypt_key),
            algorithms=["RS256"],
            audience=audience
        )
    except jwt.exceptions.InvalidTokenError:
        return None, f"Unable to decode token due to some issue"
    return decoded, ""


keys = {"keys":[{"kty":"RSA","use":"sig","kid":"YTceO5IJyyqR6jzDS5iAbpe42Jw","x5t":"YTceO5IJyyqR6jzDS5iAbpe42Jw","n":"ieQwBxFWmWZaQ32uVFUu8DiwrWMG9U95AKJMTruqVSKf8bIy25MKo25YntqW8etdn5IBCehDfSrPNtjGT0uIsiRdGVfqJFvTfqszWxho0nNN8RUecVuqSRSmCaaV9sCBcU40d1rXtNoHbh5V2hDSfKAbLAldN0DgW3Anp_YsMfGr6qrSuE4Ynm2P2k0e_2eKfhcvS9fe2_WNb_6sr09ZedY4yQVUVaiW16OIxlwcVesXxc3iQV19T9uAtlajtpCuiAQsu47lEjuggSDmIgl8B0i67UCUWCNezz4ylcQQRjUi-ba95HMYfnFPDkapZzK16Qx2IHoVzzytOfse7ZqFUQ","e":"AQAB","x5c":["MIIC/jCCAeagAwIBAgIJAJZMx/LQIwFdMA0GCSqGSIb3DQEBCwUAMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwHhcNMjUwMTA0MDQzNDM0WhcNMzAwMTA0MDQzNDM0WjAtMSswKQYDVQQDEyJhY2NvdW50cy5hY2Nlc3Njb250cm9sLndpbmRvd3MubmV0MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAieQwBxFWmWZaQ32uVFUu8DiwrWMG9U95AKJMTruqVSKf8bIy25MKo25YntqW8etdn5IBCehDfSrPNtjGT0uIsiRdGVfqJFvTfqszWxho0nNN8RUecVuqSRSmCaaV9sCBcU40d1rXtNoHbh5V2hDSfKAbLAldN0DgW3Anp/YsMfGr6qrSuE4Ynm2P2k0e/2eKfhcvS9fe2/WNb/6sr09ZedY4yQVUVaiW16OIxlwcVesXxc3iQV19T9uAtlajtpCuiAQsu47lEjuggSDmIgl8B0i67UCUWCNezz4ylcQQRjUi+ba95HMYfnFPDkapZzK16Qx2IHoVzzytOfse7ZqFUQIDAQABoyEwHzAdBgNVHQ4EFgQUgYhwGR0+XNfmFTvUNMGZmR9iQP4wDQYJKoZIhvcNAQELBQADggEBAGd81nj7DhZrh9lPdEoMCMbc2BwWphfq28n18CH2wUKmzadGLbQgcjD0QLrNpJUeI18511PCjE4AhzD7cXY+1m0AMYEn63wDDa4uDrgFpVMUZtnvdgWgPytLgqLmAN1O7n5TirOBPh5mbOab2hZXUe9PlRT/F8UJRWqtH5yA0LloZ0wJ30wChwfC2Jc8Q79S7kS8ZnHqMFS/WW8FYbAl6v/mK1UqBUp2QNtZIwSMsAHa9cfUq5o5CxI3oaj85pCvfz4SF4XGupuq5zTYKvbOQJ8ggikItbZfwum23UKFHv9J3sxWgimeH0A5TUPw1iWbrQ7dCkEr5omzt15yfUf26rs="],"cloud_instance_name":"microsoftonline.com","issuer":"https://login.microsoftonline.com/{tenantid}/v2.0"},{"kty":"RSA","use":"sig","kid":"dH-ot5V2o9ccrQBIB4LAkkPmMUg","x5t":"dH-ot5V2o9ccrQBIB4LAkkPmMUg","n":"0YsOoA0v5HD_XzOwLHfJcGWN6-vVdAoJtaTPl9QkKk9M2KQVAxzPS5TKFsbBXftg4KmoaOAPKRtz8xphsqXLsUeauDSaP5jEgBO24pvlQG4Rlea6ZtxDsNK8va0RMAU8IsL1CuqJN73BwBjYwZl9j8QB06decCxeRVF-BeFKfi0cVM_ZO_v17TXGZjXziGxJlx6xhH96s9p0sYD5-tCOQRJaoRZH2JBm3mhYEFomIRTKmjvrzQLgzShO71PL4SnFj79Ye6LoWzfjhG3urnpspFZ3ds2oO1oHCGaJ4d5RP2sDx04ucfntDgZGmO5qqNUZhWxPQZ4aWlvbbMsroSJuvQ","e":"AQAB","x5c":["MIIC/jCCAeagAwIBAgIJAKkxMJro15JaMA0GCSqGSIb3DQEBCwUAMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwHhcNMjUwMTA4MDY0ODExWhcNMzAwMTA4MDY0ODExWjAtMSswKQYDVQQDEyJhY2NvdW50cy5hY2Nlc3Njb250cm9sLndpbmRvd3MubmV0MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0YsOoA0v5HD/XzOwLHfJcGWN6+vVdAoJtaTPl9QkKk9M2KQVAxzPS5TKFsbBXftg4KmoaOAPKRtz8xphsqXLsUeauDSaP5jEgBO24pvlQG4Rlea6ZtxDsNK8va0RMAU8IsL1CuqJN73BwBjYwZl9j8QB06decCxeRVF+BeFKfi0cVM/ZO/v17TXGZjXziGxJlx6xhH96s9p0sYD5+tCOQRJaoRZH2JBm3mhYEFomIRTKmjvrzQLgzShO71PL4SnFj79Ye6LoWzfjhG3urnpspFZ3ds2oO1oHCGaJ4d5RP2sDx04ucfntDgZGmO5qqNUZhWxPQZ4aWlvbbMsroSJuvQIDAQABoyEwHzAdBgNVHQ4EFgQUQeFcxPOrX3Y9CRQjD4DPEKk14XQwDQYJKoZIhvcNAQELBQADggEBADRmgL+djEZm/K/zqMpC/yhKPhPA3uXWz2ttwQElutWAMLczom6czKFTBfh3XMMj5gpjJesNC72DRSbMXmQ6QbV9i1y7i0yMvnWeHBJe+gU5ocpN3EiGg+I19Gd/wARDq7R7QQUT/+YM3h0i6KnaE5YPp6q1cqX4PXg+rSAc1uKVQ80+S2ibMObYdflxCLb8SElmgWKzi4yZvsaA0hfUi97vwtsotoOdpAuXWOLk28TJqkxE0raZqGUZeT+5WP2uR7VTArbZxEwY/J0jBVVLQEcMqLIT3QJjtwLym/vJU9fT1QHpHzna9uONXJi+r82CvWwwmlPVteI4nrpBaJEUB3s="],"cloud_instance_name":"microsoftonline.com","issuer":"https://login.microsoftonline.com/{tenantid}/v2.0"},{"kty":"RSA","use":"sig","kid":"imi0Y2z0dYKxBttAqK_Tt5hYBTk","x5t":"imi0Y2z0dYKxBttAqK_Tt5hYBTk","n":"vWNAUO6SsXegVgtOXEc6KVOMWEpSWc8dzo-iAYa886u7RRVKUukEypuJ5kpq8xzzeFI5h3s4JEPEsjMKZgVpjMMcSa2B4Q78K7kGCFdviMCqnsnYUQvz9Buwuw7u3gKSJhxGyNNqB6RfECWz3tM7l-0eogJtA2Yin5fFnZe3HZ7-nSYOwnIOREKOV-_In9VcXKJc_jCQJ1zeBtyjQ2i61kibtUABbUhMd0ytSnHOHVPu4nN1AMRpMcqKBVXL9uKaiSiNklYnVPHAyHIl8olg-gMOCQ8Ca8qoG2mH-skJnQz_MQPxWQSpwSpbE1k89uEq_sRmmji6EOrb0zSxvqev1Q","e":"AQAB","x5c":["MIIC/TCCAeWgAwIBAgIIZcqSu7KdqngwDQYJKoZIhvcNAQELBQAwLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldDAeFw0yNTAxMjcyMDE4MjFaFw0zMDAxMjcyMDE4MjFaMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC9Y0BQ7pKxd6BWC05cRzopU4xYSlJZzx3Oj6IBhrzzq7tFFUpS6QTKm4nmSmrzHPN4UjmHezgkQ8SyMwpmBWmMwxxJrYHhDvwruQYIV2+IwKqeydhRC/P0G7C7Du7eApImHEbI02oHpF8QJbPe0zuX7R6iAm0DZiKfl8Wdl7cdnv6dJg7Ccg5EQo5X78if1Vxcolz+MJAnXN4G3KNDaLrWSJu1QAFtSEx3TK1Kcc4dU+7ic3UAxGkxyooFVcv24pqJKI2SVidU8cDIciXyiWD6Aw4JDwJryqgbaYf6yQmdDP8xA/FZBKnBKlsTWTz24Sr+xGaaOLoQ6tvTNLG+p6/VAgMBAAGjITAfMB0GA1UdDgQWBBQ3jJNZaD5JanfQoBXsAkfd7fwqPjANBgkqhkiG9w0BAQsFAAOCAQEAOptwTJGTtUor1e7yQ9Cl+jMfQQrdKy5Sz+Qz+qqs5m59bTRSfCH79jIZOvkX1eW0O581buoCyvMDhTRB2U+YShptzMtQZPr8aTyupUjkFnP7hC7aPg3buuKBooQsU3L++ed7atoZjATmH0tWi2T403lAGIwhSK3KF6EPKOoktYSrLzIyvWY2vNUQzdME5bwekklph/y1uS2lunqqZtXvUj7DK4Ge4na2U3qvFsa84st/mBL6i3tRSvlLTAMpJoh3T7OgeFHvu+xMPbc/AWBxKVPfVZ/sl9cAZg0H3LLdn3WPVEEuQehFmCIXxJ5f8Lq9Y0OLoBL41tN0FsHYsQ2Oag=="],"cloud_instance_name":"microsoftonline.com","issuer":"https://login.microsoftonline.com/{tenantid}/v2.0"},{"kty":"RSA","use":"sig","kid":"OiJmAVx5TY3TDGzu-3SxDSg6gR8","x5t":"OiJmAVx5TY3TDGzu-3SxDSg6gR8","n":"01V2Sdrfb83w5cf1VKTneUALvipF-828BEfCDCJfhVALsQyJiFUnmnuqoQJOvbOZyJ9qRUUqD8vA0iJjFvinj1Ct-zmkP__-rnSwZ9sc9Wl4lZXjxPoLbgDNc1WpXdnCnCaDH6iGmIkBvB0VsAA5sNfGy_VevBgoRCorQCp9Q2pDKn1C0i458jQC9FM7Iza-bGrLEQXj0mn8XF6XxiEnePtpRVw__qOHW25IHuKweXTk13l4v3yOauyeqbPnpF3VPzUFJpr71FUaNHbWpiDA3ZaOTEO3nGYkI-0TD4cjv2f0O_mfWYAIteaja5MKxX2a1uTNKV4z7vHn674pmCcBPw","e":"AQAB","x5c":["MIIC/TCCAeWgAwIBAgIIZodHMNnsjEwwDQYJKoZIhvcNAQELBQAwLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldDAeFw0yNTAxMzExOTA1MjBaFw0zMDAxMzExOTA1MjBaMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDTVXZJ2t9vzfDlx/VUpOd5QAu+KkX7zbwER8IMIl+FUAuxDImIVSeae6qhAk69s5nIn2pFRSoPy8DSImMW+KePUK37OaQ///6udLBn2xz1aXiVlePE+gtuAM1zVald2cKcJoMfqIaYiQG8HRWwADmw18bL9V68GChEKitAKn1DakMqfULSLjnyNAL0UzsjNr5sassRBePSafxcXpfGISd4+2lFXD/+o4dbbkge4rB5dOTXeXi/fI5q7J6ps+ekXdU/NQUmmvvUVRo0dtamIMDdlo5MQ7ecZiQj7RMPhyO/Z/Q7+Z9ZgAi15qNrkwrFfZrW5M0pXjPu8efrvimYJwE/AgMBAAGjITAfMB0GA1UdDgQWBBQb8INOKgtPBPKxL6yT0J2aAFUN/DANBgkqhkiG9w0BAQsFAAOCAQEAof+x1b7rpKeON1XBpjY+kduzzEETU5aS8qtxwzIEWfp4CUDwbk3HvvCc2gpCSonuYsGSwmpYwH5BQwTGFd96NggppEJlvYqoDc4hQ1mU5oGBkeuRVqz0kxk9hno/Uahhy7sM0Yjcx40gW0BDK0Kt3ng1EsP5cRx2unzUBc4r98csKyUnki0QistDnq4s/yKScLBZihgfvx7C8e2SEhFy3eQTcGdKFEGYUwjcBOifT1e39qULGL78JoLzGUs4imKGT71udcC/k0jtiN3YQgydfWP5ELc640IpOXdB03CDXJZnI4hF3ifdFQaNR+JBcsx6XnVQDYBZr752N+W3VTwWVg=="],"cloud_instance_name":"microsoftonline.com","issuer":"https://login.microsoftonline.com/{tenantid}/v2.0"},{"kty":"RSA","use":"sig","kid":"7MQ8O1qILcYdNHYq_rZ6tkj1d20","x5t":"7MQ8O1qILcYdNHYq_rZ6tkj1d20","n":"m6UhWiyQfLhKQrXURCpzM5WPVCVyu4M8mD9ZmJ17BdoSO4QN0mhzSKL2G81Lq3hRaGvzog7ALPLAzokNI7BcCX3G_rczEYi4WOY2bBWehTQpuNtoUbZI_F-Xg0TWuDDnktLUx-cjcqBUQdMU9rHbuxCHSD3amMXeH06e7tI5_Hw2hiw-xZfW0X_oPLwqU-3nhDSFfG5vfR2VhwgFuKZvAXN0fjx3bT4pqKmRsE-Div4t8FdkR-DChXKx5eixiyZlbcE5LvF4y8C8vIyk4305HlRH57y4NjLu1Ra5b2nMCnIyUTk6JXkUIRMND-ljfI4pwDS4IukbOiLlRLKOX0Sk5Q","e":"AQAB","x5c":["MIIC6TCCAdGgAwIBAgIIBdyrYnfLPzQwDQYJKoZIhvcNAQELBQAwIzEhMB8GA1UEAxMYbG9naW4ubWljcm9zb2Z0b25saW5lLnVzMB4XDTI1MDExNTE3MDE1M1oXDTMwMDExNTE3MDE1M1owIzEhMB8GA1UEAxMYbG9naW4ubWljcm9zb2Z0b25saW5lLnVzMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAm6UhWiyQfLhKQrXURCpzM5WPVCVyu4M8mD9ZmJ17BdoSO4QN0mhzSKL2G81Lq3hRaGvzog7ALPLAzokNI7BcCX3G/rczEYi4WOY2bBWehTQpuNtoUbZI/F+Xg0TWuDDnktLUx+cjcqBUQdMU9rHbuxCHSD3amMXeH06e7tI5/Hw2hiw+xZfW0X/oPLwqU+3nhDSFfG5vfR2VhwgFuKZvAXN0fjx3bT4pqKmRsE+Div4t8FdkR+DChXKx5eixiyZlbcE5LvF4y8C8vIyk4305HlRH57y4NjLu1Ra5b2nMCnIyUTk6JXkUIRMND+ljfI4pwDS4IukbOiLlRLKOX0Sk5QIDAQABoyEwHzAdBgNVHQ4EFgQUoRH/cFaPV6V0CUsQd6JC0mtpWaIwDQYJKoZIhvcNAQELBQADggEBAG65nK90vkQkkEMHROwBJeEy+U+q6ugMQ8hX/A0FiLzqJWAtstItg4ZGHH69iJSYtTvt+EKjxwhcDse3iKm2/jtlUmwfF0QX7nowUxprxCPSVduHkxzkOVmsD8/jKjIwvfSapUVzuvHmV4mx20+fqMKeEfTBn7E8ipHnQKJQAq04VI7w4yIHRjNafnRjqBWsMt+nNZ9JBujqdMb6xAktlMc4vuDa/5HzJaLCsp8jXJrbIoZ4QQt6hMLmh6bhdHQoX1STIUsxi3e2v1xzFRr70i38W09xTr4q1vkNeEYx3Qdwc8OW6kWGIaxtR9YNn+YePwInfmPxITLBbLeuI5NdCks="],"cloud_instance_name":"microsoftonline.us","issuer":"https://login.microsoftonline.com/{tenantid}/v2.0"},{"kty":"RSA","use":"sig","kid":"GP9ooSiPGgx444VrE6CWOt6_6xs","x5t":"GP9ooSiPGgx444VrE6CWOt6_6xs","n":"ozH9HJAkcEn23YeR0uYw2W0x087f7LzGfy5x20hJClLjLmgbKTZ9wHRxi1b7STJeQqjnLDrnwkYjTSYYAnIg99RA4uNAdRviTTJqpJwfiVTy0eIr18l4ksrtbDOtUSJUGURYPw-AZVV1W4aU9MLvAa6J2z2-S8ENqyy_i7xXLxUzYJSBtXTo9b1lHdEBzlqtxXoD-50k0qhY20YiyGHp7KXUyxVH6atu2ShHjO2TCl-8qp4xyXxwTp2ciUkZ1w0PiBKsfC2r-Ya0gQNXTdLwnXXkVNfCCz-G8uY2Ta2Y6R_Z_jKGo04pulkRhYa2SOnd4URB9DIBqrH86cI5JVkC3w","e":"AQAB","x5c":["MIIC6TCCAdGgAwIBAgIITnK9SyMdS0QwDQYJKoZIhvcNAQELBQAwIzEhMB8GA1UEAxMYbG9naW4ubWljcm9zb2Z0b25saW5lLnVzMB4XDTI1MDIwMjE3MDE1M1oXDTMwMDIwMjE3MDE1M1owIzEhMB8GA1UEAxMYbG9naW4ubWljcm9zb2Z0b25saW5lLnVzMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAozH9HJAkcEn23YeR0uYw2W0x087f7LzGfy5x20hJClLjLmgbKTZ9wHRxi1b7STJeQqjnLDrnwkYjTSYYAnIg99RA4uNAdRviTTJqpJwfiVTy0eIr18l4ksrtbDOtUSJUGURYPw+AZVV1W4aU9MLvAa6J2z2+S8ENqyy/i7xXLxUzYJSBtXTo9b1lHdEBzlqtxXoD+50k0qhY20YiyGHp7KXUyxVH6atu2ShHjO2TCl+8qp4xyXxwTp2ciUkZ1w0PiBKsfC2r+Ya0gQNXTdLwnXXkVNfCCz+G8uY2Ta2Y6R/Z/jKGo04pulkRhYa2SOnd4URB9DIBqrH86cI5JVkC3wIDAQABoyEwHzAdBgNVHQ4EFgQUAglPRZDkUCuL2sfZc2UlwUnGpEgwDQYJKoZIhvcNAQELBQADggEBAJUQKzWGldEvvrca+8kCyLq3MCbfQwtjljQ4WoY172O4oaLAgjOL3gGR1cSPSjlpgPUOLMyHD+w7aw1DRY+8f6m3rPyyiKQ+r0xCv521JpeZRDE2+pf4kdCjRJa7Hg8IJHyKsiUs/ejC30Bs1R43hWQJj+XWhBDdWagS6xzI5NTHN+VW9XSpn0u18HZaCvai4OFIcMBwQrowKvO8r4SqYBrqEAZhE7kOfF5V8mTAdfvVw4sa7t/ZrMy5kFtve9IR6LektWGJWxMu+/whMJVxkW7DuP8QA7e4AcMFEOAPe+6+RCzjyZN1wDdGRp0XExJVk9yq+Fodg/j/EGIPkAB0JgU="],"cloud_instance_name":"microsoftonline.us","issuer":"https://login.microsoftonline.com/{tenantid}/v2.0"},{"kty":"RSA","use":"sig","kid":"emt-c09x6CJ3y689a4FsJcHmZuU","x5t":"emt-c09x6CJ3y689a4FsJcHmZuU","n":"jPMLhViynsQ_CoY6GlimGuzreew-7OUzJG32-7ImZkRJ37iEATaaMzi6QQwEBKq8kssuncGd-lWvY16beGsSCDqdHiaCxQ3i3Rlu1bCZZhlvg0IDUfMRwA_iNvn66JtvQ7Gok3swXvjWXtmUH682nIzYjAiI-uBe42j9-NDssodabNA6LkDRg7IXyNc2Uu-Ovn_0tY3lQ4aE_O3rROHAHK-PB5rrAfkjMUkx5A_YSBCd-7rlVFzAbXGC1BPPrJC_3LpRIvpVHSNia4V6y5NBR2RAoL5e8d_II12Alivl_QMoEEJGwQacL4yOrnsz3dNPPaoRdeiyjkBg4zuqcMhVQw","e":"AQAB","x5c":["MIIDCzCCAfOgAwIBAgIRAMU22mI1SFqpuNL/vQh73XQwDQYJKoZIhvcNAQELBQAwKTEnMCUGA1UEAxMeTGl2ZSBJRCBTVFMgU2lnbmluZyBQdWJsaWMgS2V5MB4XDTI1MDIwMjIwMDIyNFoXDTMwMDIwMjIwMDIyNFowKTEnMCUGA1UEAxMeTGl2ZSBJRCBTVFMgU2lnbmluZyBQdWJsaWMgS2V5MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAjPMLhViynsQ/CoY6GlimGuzreew+7OUzJG32+7ImZkRJ37iEATaaMzi6QQwEBKq8kssuncGd+lWvY16beGsSCDqdHiaCxQ3i3Rlu1bCZZhlvg0IDUfMRwA/iNvn66JtvQ7Gok3swXvjWXtmUH682nIzYjAiI+uBe42j9+NDssodabNA6LkDRg7IXyNc2Uu+Ovn/0tY3lQ4aE/O3rROHAHK+PB5rrAfkjMUkx5A/YSBCd+7rlVFzAbXGC1BPPrJC/3LpRIvpVHSNia4V6y5NBR2RAoL5e8d/II12Alivl/QMoEEJGwQacL4yOrnsz3dNPPaoRdeiyjkBg4zuqcMhVQwIDAQABoy4wLDAdBgNVHQ4EFgQUyeA2Psma0S3yH1QPTotuAxMp8DIwCwYDVR0PBAQDAgLEMA0GCSqGSIb3DQEBCwUAA4IBAQALpIzzUpYH8NGIYFLleQY8e3rBqTrzzRBsD2Jn/Un4U5ayJeZh0oeVOwBmA5HzrO+U/1o2e4OCOKLdyWZ0xkUJmvyNKH+1N8nhqKtst8bwRaT/tPHP7pvtTl9BHoGcaUZhiacDswmBVvPcbAavynMwBp4EXxVWihkIGGcSU7DdB5a4ygVrZmcEgDnDKl/avUG7/iKaCh6goEO4HaYEX5L3kjSH6XVDv7F82ke28tEFilxbPAqCP0MJ2xXFdnCQkzLFG94qghsKhHl7BlhCxYNG9rhsplLZNZJzFNQqmMO/LGSHhRrtQdr/FfSwMdT7glxddj24qwFtybAd/k6LnY+u"],"cloud_instance_name":"microsoftonline.com","issuer":"https://login.microsoftonline.com/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0"},{"kty":"RSA","use":"sig","kid":"-cHvLoTRMfWXWuNxETS71oJ5vfc","x5t":"-cHvLoTRMfWXWuNxETS71oJ5vfc","n":"kzRkasC4SrApdvLeK-3vr_pNNOEqucf-REk5B9CpFLk7Rl6DLL7tT6HhYJkVwSXWJDhjUuy4vI1VvOLoFstMzPf8Gqh5-IC4_XvOCFtV0I_SBWMzJ5Smkd2tch5VxSe8jlRsOW1PQr2zj05GOXrHcmk4fF5ePDTgAmIIMPrTgwioBbFqhc6B6seJA42t0XtrwhrkvEbmxwjGFRgSXRH9fP_R6vBbb5ed8tYEOB0u2RM63xhwbnfAlTbp7TEtbwHnbWPomrj0h_GjSuW13cp0kxeswbyXOr4XggT9nn-d_ZqRYfADgekyrEZvF0DlmMmE4tGvSwbKpzWVdaxIyEs5SQ","e":"AQAB","x5c":["MIIDCzCCAfOgAwIBAgIRAJkNx0FMdQp1L9C/qHb6wX0wDQYJKoZIhvcNAQELBQAwKTEnMCUGA1UEAxMeTGl2ZSBJRCBTVFMgU2lnbmluZyBQdWJsaWMgS2V5MB4XDTI1MDExMDIxMDMzM1oXDTMwMDExMDIxMDMzM1owKTEnMCUGA1UEAxMeTGl2ZSBJRCBTVFMgU2lnbmluZyBQdWJsaWMgS2V5MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAkzRkasC4SrApdvLeK+3vr/pNNOEqucf+REk5B9CpFLk7Rl6DLL7tT6HhYJkVwSXWJDhjUuy4vI1VvOLoFstMzPf8Gqh5+IC4/XvOCFtV0I/SBWMzJ5Smkd2tch5VxSe8jlRsOW1PQr2zj05GOXrHcmk4fF5ePDTgAmIIMPrTgwioBbFqhc6B6seJA42t0XtrwhrkvEbmxwjGFRgSXRH9fP/R6vBbb5ed8tYEOB0u2RM63xhwbnfAlTbp7TEtbwHnbWPomrj0h/GjSuW13cp0kxeswbyXOr4XggT9nn+d/ZqRYfADgekyrEZvF0DlmMmE4tGvSwbKpzWVdaxIyEs5SQIDAQABoy4wLDAdBgNVHQ4EFgQUCKY/k1b7uzbOsVB/djsRpWXs3HcwCwYDVR0PBAQDAgLEMA0GCSqGSIb3DQEBCwUAA4IBAQBXTDgF1liBJ8DzWqheOdIAOBu7U7RbG/OFCkVylL8pyM2267rD1+j7pxSqjcRibHpSsfs9iA1w3JmSU2X3RE8/EqIr4jm9OtJyZXcxCCDbWlRYC8D9fx79zeZwm1BCY6SNBaMOzPEuTk2ssNMpvMf87fTWteXuvqGN8BYqJIbJUtPe/YnFj9FGh6M15uOPfl4I41HsM6BGK6aWS97tp4C+hx/sCFJNhhQ2rGKp4rHlOP5Qfr+K2ZVTDQ7KRiFeeLi/Nu3rgtEm6XQLjtNl53Cz2cmK4yfwRstyviU+aMpLbD6Cc0hJ6K0ZvpPaiVEmInECFNZJGpwcrgAel07WA7Jc"],"cloud_instance_name":"microsoftonline.com","issuer":"https://login.microsoftonline.com/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0"},{"kty":"RSA","use":"sig","kid":"aB0xDdGXk535PvewBP9Hl5pf7wc","x5t":"aB0xDdGXk535PvewBP9Hl5pf7wc","n":"oVqM3iwVBo1YghaFpKSJpMinrYMTBgDlAwfPuuGepQDrXG0My4C7ZvQ1srMlHKQG5ruTO2_cNFepuPyg1CrM5gVXbLutQ_Q_vDLkBpBzLlbEHEZ9pDu12HplHDmXgITHxEskMzZ115LFzt9Tc7ftHRtt6lwNj8CBbOwFnlOTXSzWwbrNdurwAkXwymJ0tz8ABYUCVBmIupuX-g1XdBu3BI7C6pWsqdQS_81WM-6qk_OZqEv3C0SIRKXYGBNbY5AdqG4gLrOqmnoXKnOo13kPY0bjx7UAD18wtCshiJY2elC_3ljVhtGu0U86TfQUDY5tGgrQPQy-udoPsgKXsv_mVQ","e":"AQAB","x5c":["MIIDCzCCAfOgAwIBAgIRAOM3wRp7X25WmIvQTAndPGMwDQYJKoZIhvcNAQELBQAwKTEnMCUGA1UEAxMeTGl2ZSBJRCBTVFMgU2lnbmluZyBQdWJsaWMgS2V5MB4XDTI0MTIyOTAwMDUyN1oXDTI5MTIyOTAwMDUyN1owKTEnMCUGA1UEAxMeTGl2ZSBJRCBTVFMgU2lnbmluZyBQdWJsaWMgS2V5MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoVqM3iwVBo1YghaFpKSJpMinrYMTBgDlAwfPuuGepQDrXG0My4C7ZvQ1srMlHKQG5ruTO2/cNFepuPyg1CrM5gVXbLutQ/Q/vDLkBpBzLlbEHEZ9pDu12HplHDmXgITHxEskMzZ115LFzt9Tc7ftHRtt6lwNj8CBbOwFnlOTXSzWwbrNdurwAkXwymJ0tz8ABYUCVBmIupuX+g1XdBu3BI7C6pWsqdQS/81WM+6qk/OZqEv3C0SIRKXYGBNbY5AdqG4gLrOqmnoXKnOo13kPY0bjx7UAD18wtCshiJY2elC/3ljVhtGu0U86TfQUDY5tGgrQPQy+udoPsgKXsv/mVQIDAQABoy4wLDAdBgNVHQ4EFgQUt9KYDuU6tZfVe7SsO9zs3DNT3YgwCwYDVR0PBAQDAgLEMA0GCSqGSIb3DQEBCwUAA4IBAQB4RUzhNlS3VQVAL0x8PC3u0/ge2LTlcbL1x2hjoeacCRAxDIPtJbAY6KUquiKzDkZwHBRTjnGLpQHYQjffv7qF3KrAgc29tc/jIq9dpZ+rir4yjrCGcXsRyCd7CfGzEAZHmfJCFdOsJSWIZiDsjOM5PaML1kUl45iRU6VQLad7RqprdddCsLuXhciXsMT6sJs1opUlLmVi9pF02HMd/63yWrFY3Px1qfDC8W5aQFA6IzTVbKNgBkBS45KebdZ0oYY/0wozNPZOtctpc2cMoIpSxNGQ6SpF2JEdVntoWyjBgxfn3ddwQfTHjZ4/BSvTTC954Ft6XhcENdRCH8iuy6kz"],"cloud_instance_name":"microsoftonline.com","issuer":"https://login.microsoftonline.com/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0"},{"kty":"RSA","use":"sig","kid":"yef4qNtpIsfj5moDaHCqP5zlBAc","x5t":"yef4qNtpIsfj5moDaHCqP5zlBAc","n":"mw709TPFFWktSM2H-BpZqDCImsFudwpYjabyPurErS2d1polqDAyx6Qaic2J9XyqThhSjRVK5rYVqcaK8yjqOW7neKV9xC2oGcmA8WS6WwlvTuwsPAVPV1Gwna9DALBz-bhZvsQ-e-WZJp1d1aQ1PVubc9lveDMKlMu05abf9mtlvoS3kUr3EPNg22B82kgyGXR-jQAsMiqE-W_HTlLNu9u79qBZfFiQ2YNzDevEk8ARx35YIBh5lL0HbahAWp1X2eyVWFW-fscapwQHd78p5PYp-QLLYpuwDX7_-FdQwoe8-2jrKavYlwUKEGw6tT0H9X0rNLLNiwFDozZ9mJxTww","e":"AQAB","x5c":["MIIDCzCCAfOgAwIBAgIRAPciYzAougxYP/KWCOrEcH8wDQYJKoZIhvcNAQELBQAwKTEnMCUGA1UEAxMeTGl2ZSBJRCBTVFMgU2lnbmluZyBQdWJsaWMgS2V5MB4XDTI0MTIxNjAyMzIzM1oXDTI5MTIxNjAyMzIzM1owKTEnMCUGA1UEAxMeTGl2ZSBJRCBTVFMgU2lnbmluZyBQdWJsaWMgS2V5MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAmw709TPFFWktSM2H+BpZqDCImsFudwpYjabyPurErS2d1polqDAyx6Qaic2J9XyqThhSjRVK5rYVqcaK8yjqOW7neKV9xC2oGcmA8WS6WwlvTuwsPAVPV1Gwna9DALBz+bhZvsQ+e+WZJp1d1aQ1PVubc9lveDMKlMu05abf9mtlvoS3kUr3EPNg22B82kgyGXR+jQAsMiqE+W/HTlLNu9u79qBZfFiQ2YNzDevEk8ARx35YIBh5lL0HbahAWp1X2eyVWFW+fscapwQHd78p5PYp+QLLYpuwDX7/+FdQwoe8+2jrKavYlwUKEGw6tT0H9X0rNLLNiwFDozZ9mJxTwwIDAQABoy4wLDAdBgNVHQ4EFgQUWMjkNWDYipJUZfCQthYfEkOYxDUwCwYDVR0PBAQDAgLEMA0GCSqGSIb3DQEBCwUAA4IBAQBV+UPkfa6ClkBQqyOAcQN4YVPoB8LFpNUYXWho2+ZZWOMlwJ4VHDqvf+rnj/LTxb+TkXqfVM2gEpzuMSNXJPQXszImReNjiA68neUB3fgyWGJc76jhccjUQim184c1/SdFPShPFk2BhZB84dJt3PfclZLm1pBjBegFYZfiK/MpqV/l+c7VVj/LYrhiYKDo5E3KC0MK+PWQ7IbWMZ2Ws/2cQdP7dajizzEt8MqxzyTvylXF8Q+l3na5+l4c+ycHGc7RANgdpVdlKAqj1K5hshyqTvZ4DVMoWVaHJHl2knPNFjt3W36mQDn38pfLSnjMNfrfVeUkgMa16MrWA083Q1ew"],"cloud_instance_name":"microsoftonline.com","issuer":"https://login.microsoftonline.com/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0"}]}
id_token = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Ii1jSHZMb1RSTWZXWFd1TnhFVFM3MW9KNXZmYyJ9.eyJ2ZXIiOiIyLjAiLCJpc3MiOiJodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vOTE4ODA0MGQtNmM2Ny00YzViLWIxMTItMzZhMzA0YjY2ZGFkL3YyLjAiLCJzdWIiOiJBQUFBQUFBQUFBQUFBQUFBQUFBQUFEaVdIQzJ2WUM0YW9KUGREbElKMVZVIiwiYXVkIjoiZTc1MzE1MTQtODkxMy00N2E4LThjZDItYjgwZGNlZjk1NWI3IiwiZXhwIjoxNzM4OTQ3MzMxLCJpYXQiOjE3Mzg4NjA2MzEsIm5iZiI6MTczODg2MDYzMSwibmFtZSI6Ik1hZGlzIE1lZXMiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJtYWRpc21hbjVAb3V0bG9vay5jb20iLCJvaWQiOiIwMDAwMDAwMC0wMDAwLTAwMDAtODJhMC05NDZjYWMxZGJhYzkiLCJlbWFpbCI6Im1hZGlzbWFuNUBvdXRsb29rLmNvbSIsInRpZCI6IjkxODgwNDBkLTZjNjctNGM1Yi1iMTEyLTM2YTMwNGI2NmRhZCIsIm5vbmNlIjoiMmI0OWYwMmE4YzIxZDNmYmQ0ZTViZWYzZGU0NzFjODMzMjZiNjM4MTk4YTNjNDEwMTk1NWM3NWYzOTc1MDljZCIsImFpbyI6IkR1QlVkakNzdk15ZUlzZllKTzdtV2FDSmdOYmtBNkd3eGw1UVJlRks3Smdyb1c5OUZmTGN3OEMwV093WjhTSERuNzFjS2s5dHNmRHZ5Y3YxV0l6eVhzelg5VGRpViFacU1KVEZGOUp0SWhUSXM4Z2l2ZmtoNllzQTliV0d6a3FyS3BpWERpYWljSFVZYUljSCpsZHFYRDViYjdXaVZiWGI1IVZqYTRtN0dUQjQifQ.SjK9oYUf92OL5eIRzRHh3hKTMJEQ8AsRNWTh6e4JlO2zX17EeZPc_gXAbPbX9XWGyMniO6uUUgJiL8Ng4elBOcRyJkaQanSxHJWYhLSjf7wj9JrXyQbjeX1MluUR8O4IDAh_YrYQX6O_VXptX6Jf1zxZJEb5gas8i7ffGKy9geGf4tTxD1JUybe-32o2O1UqtE_WwHCA9b9DDYXR7jF_a2b3hTXipjrX9YBcYEy426pRR-Riv4JQKReu034dZzsyH9wAYRt0U8vrBBttCHlKzNu70U--3kVPjD79_cgrLY1qpXu7qkhq677KJW95FrNO7I3Gm18kwzaFUpbxO70gSg"

print(decode_jwt_token(id_token, keys))